name: Test OCR Skill

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install Tesseract OCR
      run: |
        sudo apt-get update
        sudo apt-get install -y tesseract-ocr tesseract-ocr-chi-sim tesseract-ocr-eng
    
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pillow
    
    - name: Make scripts executable
      run: |
        chmod +x scripts/ocr.sh
        chmod +x tests/test_ocr.py
    
    - name: Run tests
      run: |
        cd tests
        python test_ocr.py
    
    - name: Test bash script
      run: |
        cd scripts
        ./ocr.sh --help
    
    - name: Test Python script
      run: |
        cd scripts
        python ocr_tool.py --help
    
    - name: Check skill file
      run: |
        echo "Checking skill file structure..."
        if [ -f "ocr-skill/SKILL.md" ]; then
          echo "✓ Skill file exists"
          # Check for required sections
          if grep -q "name:" ocr-skill/SKILL.md && \
             grep -q "description:" ocr-skill/SKILL.md && \
             grep -q "metadata:" ocr-skill/SKILL.md; then
            echo "✓ Skill file has required sections"
          else
            echo "✗ Skill file missing required sections"
            exit 1
          fi
        else
          echo "✗ Skill file not found"
          exit 1
        fi